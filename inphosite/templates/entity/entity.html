<%! import urllib %>
<%! from inpho.model import Thinker %>
<%inherit file="/base-tree.html" />
<%namespace name="bootstrap" file="/bootstrap-form.html" />

## Header
<%def name="title()">${parent.title()} - Entity - ${c.entity.label}</%def>
<%def name="head_title()">${c.entity.label}</%def>

<h1>${c.entity.label}</h1>

<%def name="breadcrumbs(node)">
<ul class="breadcrumb taxonomy-breadcrumb">
  <li><a href="/taxonomy">Philosophy</a> <span class="divider">&rarr;</span></li> 
  <%
path = list() 
current = node
while current:
    path.insert(0, current)
    current = current.parent
  %>
  %for current in path:
    <li><a href="${current.url()}">${h.titlecase(current.label)}</a>\
    %if current != path[-1]:
      <span class="divider">&rarr;</span>\
    %endif
    </li>
  %endfor
  <!-- <li class="active">${h.titlecase(c.entity.label)}</li> -->
</ul>
</%def>

<%def name="printMissing()">
<div class="alert">
  <strong>No data!</strong>
  The InPhO current contains no statistical information on ${c.entity.label}.
  This is likely a new concept for the ontology, and statsitical information will be
  added after our nightly data mining. If this page continues to lack data, please
  inform us at <strong><span class="iumail">inpho</span></strong>.
</div>
</%def>

<%def name="printList(attr, alt_title='', limit=10, statistical=False, type='idea')">
%if getattr(c.entity, attr)[:limit]:
<% title = alt_title if alt_title else h.titlecase(attr.replace('_', ' ')) %>
<div class="terms span3" id="${attr}" data-source="/${type}/${c.entity.ID}/${attr}.json">
<h3>${title}\
%if statistical:
<img src="/img/empty.gif" title="List generated by statistical methods." class="icon-cog pull-right" width="16">\
%endif
</h3>
<ol class="unstyled">
%for idea in getattr(c.entity, attr)[:limit]:
<li>
    <a onClick="inpho.tabnav.appendTab('tabnav', 'i${idea.ID}', '${h.titlecase(idea.label).replace("'", r"\'")}', '/entity/${c.entity.ID}/panel/${idea.ID}')" href="#i${idea.ID}" data-toggle="tab" class="tablink"><i class="icon-search" data-toggle="tooltip"  title="Search for ${h.titlecase(idea.label)} on the Stanford Encyclopedia of Philosophy and Noesis databases"></i></a>
    %if idea.sep_dir:
    <a href="http://plato.stanford.edu/entries/${idea.sep_dir}" data-toggle="tooltip" title="Stanford Encyclopedia of Philosophy"><img src="/img/sepmanicon.png"  class="pull-right"/></a>
    %else:
    <img src="/img/empty.gif" class="pull-right" width="16"/>
    %endif
    %if isinstance(idea, Thinker) and idea.wiki:
    <a href="http://wikipedia.org/wiki/${idea.wiki.decode('utf-8')}" data-toggle="tooltip" title="Wikipedia Link"><img src="/img/wikiicon.png"  class="pull-right"/></a>
    %else:
    <img src="/img/empty.gif" class="pull-right" width="16" />
    %endif
    <a href="${idea.url()}" class="term-label" data-toggle="tooltip" title="Search for ${h.titlecase(idea.label)}">
    ${h.titlecase(idea.label)}</a>
    </li>
%endfor
## TODO: Investigate this to make dynamically loaded queries use "len"
%if len(getattr(c.entity, attr)[:]) > limit:
<li class="more"><a onClick="inpho.entity.showMore('${attr}', ${c.entity.ID}, ${limit}, ${limit})">Show more&#133; (${len(getattr(c.entity, attr)[:]) - limit})</a></li>
%endif
</ol>
</div> <!-- ${attr} -->
%endif
</%def>

<%def name="printAdminPanel(attrs)">
<div class="form-horizontal" id="admin-form">
  <fieldset>
    <legend>Admin</legend>
    %for attr in attrs:
    ${printAttr(attr)}
    %endfor
  </fieldset>
<!-- <fieldset>
    <input type="hidden" name="_method" value="PUT" />
    <input type="hidden" name="redirect" value="1" />
    <input type="button" value="Submit" onclick="$('#admin-form').submit()" />
    <input type="reset" value="Reset" />
  </fieldset> -->
</div>
</%def>

<%def name="printAttr(attr)"> 
  %if attr in ["last_accessed", "sep_dir", "language", "searchstring", "wiki"]:
  ${bootstrap.textbox(attr, c.entity.url(), getattr(c.entity, attr, ''))}
  %elif attr == 'label':
  ${bootstrap.textbox(attr, c.entity.url(), getattr(c.entity, attr, ''), search=c.entity.google_url)}
  %elif attr == 'ISSN':
  ${bootstrap.textbox(attr, c.entity.url(), getattr(c.entity, attr, ''), search=c.entity.ISSN_google_url)}
  %elif attr == "URL":
  ${bootstrap.url_textbox(attr, c.entity.url(), getattr(c.entity, attr, ''), c.entity.google_url)}
  %elif (attr in ["ID", "in_degree", "out_degree", "entropy"]):
  ${bootstrap.disabled_textbox(attr, getattr(c.entity, attr, ''))}
  %elif attr in ["openAccess", "active", "student"]:
  ${bootstrap.checkbox(attr, c.entity.url(), h.titlecase(attr), getattr(c.entity, attr, False))}
  %elif attr in ["influenced", "influenced_by"]:
  ${bootstrap.binary_list(attr, [c.entity.url(action=attr, id2=entity2.ID) for entity2 in getattr(c.entity, attr, list())], [entity.name for entity in getattr(c.entity, attr, list())])}
  %elif attr == "students":
  ${bootstrap.binary_list(attr, [c.entity.url(action='teacher_of', id2=entity2.ID) for entity2 in getattr(c.entity, attr, list())], [entity.name for entity in getattr(c.entity, attr, list())])}
  %elif attr == "teachers":
  ${bootstrap.binary_list(attr, [c.entity.url(action='student_of', id2=entity2.ID) for entity2 in getattr(c.entity, attr, list())], [entity.name for entity in getattr(c.entity, attr, list())])}
  %elif (attr in ["searchpatterns", "abbrs", "queries"]):
  ${bootstrap.list(attr, c.entity.url(action=attr), getattr(c.entity, attr, []))}
    %if attr == 'searchpatterns':
    <a class="controls btn" style="margin-bottom: 20px;" data-toggle="modal" href="#plurals"><i class="icon-cog"></i>Suggestions</a>
    <div class="modal hide" id="plurals">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h3>Searchpattern Suggestions</h3>
      </div>
      <div class="modal-body">
        %for pattern in c.entity.pluralize():
          ## Code to render checkbox for each
          <p><input type="checkbox" name="pattern" value="${pattern}" />${pattern}</p>
        %endfor
      </div>
      <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Close</a>
        <a href="#" class="btn btn-primary" data-dismiss="modal" onclick="inpho.admin.submitPluralizations('${c.entity.url(action="searchpatterns")}')">Add Pluralizations</a>
      </div>
    </div>
    %endif
  %elif attr == "birth":
  ${bootstrap.date_list('birth_dates', c.entity.url(action='date', id2=1, filetype='json'), getattr(c.entity, 'birth_dates', tuple()))}
  %elif attr == "death":
  ${bootstrap.date_list('death_dates', c.entity.url(action='date', id2=2, filetype='json'), getattr(c.entity, 'death_dates', tuple()))}
  %endif
</%def>

<%def name="dateControl(attr, relation_id)">
<form class="form-inline dateControl" name="date" action="/entity/${c.entity.ID}/date/${relation_id}" method="POST" id="${attr}_form">
  <fieldset>
    <legend>${attr.capitalize()} Date</legend>
    <br />
    <button class="btn btn-primary" type="submit" id="${attr}_submit">Submit</button>
    <button class="btn" type="reset" id="${attr}_reset" value="Reset">Reset</button>
  </fieldset>
</form>

<hr />

<script>
  // script handling form expansion/collapse for date ranges
  $("#${attr}_is_date_range").click(
  function() {
    if ($("#${attr}_date_range").is(":hidden")) {
      $("#${attr}_date_range").slideDown();
    } else {
      $("#${attr}_date_range").slideUp();          
      var month = $("#${attr}_month").val();
      var day = $("#${attr}_day").val();
      var year = $("#${attr}_year").val();
      var era = $("#${attr}_era").val();
  
      $('form')[0].reset();
      $("#${attr}_month").val(month);
      $("#${attr}_day").val(day);
      $("#${attr}_year").val(year);
      $("#${attr}_era").val(era);
    }
  });

  $("#${attr}_reset").click(
    function() {
      $("#${attr}_date_range").slideUp();
  });
  /*
  $("#${attr}_submit").click(
  function() {
  $(".variable_day").remove();
  });  
  */

  // script for validating dates
  $(document).ready(function() {
  $("#${attr}_form").submit(
  function() {
  if (($("#${attr}_era").val() == "ce") && ($("#${attr}_era_end").val() == "bce")) {
  alert("Please review your beginning and ending eras:\nyou cannot go back in time!");
  return false;
  }
  else if (((($("#${attr}_year").val() !== "Year") && ($("#${attr}_year").val() !== "")) && ($("#${attr}_era").val() == "Era")) || ((($("#${attr}_year_end").val() !== "Year") && ($("#${attr}_year_end").val() !== "")) && ($("#${attr}_era_end").val() == "Era"))) {
  alert("Please specify an era for any given years.");
  return false;
  }
  else if (($("#${attr}_year").val() > $("#${attr}_year_end").val()) && ($("#${attr}_era").val() == "ce") && ($("#${attr}_era_end").val() == "ce")) {
  alert("Please review your beginning and ending years:\nyou cannot go back in time!");
  return false;
  }
  else if (($("#${attr}_year").val() < $("#${attr}_year_end").val()) && ($("#${attr}_era").val() == "bce") && ($("#${attr}_era_end").val() == "bce")) {
				       alert("Please review your beginning and ending years:\nyou cannot go back in time!");
				       return false;
				       }
				       /* NEEDS TO SUBMIT TO DATABASE RATHER THAN CHANGE VALUE, SINCE YEAR VALUES ARE LIMITED TO FOUR CHARACTERS IN LENGTH
				       else if (#${attr}_("#${attr}_era").val() == "bce") {
				       $("#${attr}_year").val(0 - $("#${attr}_year").val());
				       return false;
				       }
				       else if (#${attr}_("#${attr}_era_end").val() == "bce") {
				       $("#${attr}_year_end").val(0 - $("#${attr}_year_end").val());
				       return false;
				       }
				       */
				       });
				       });
				       </script>

</%def>
